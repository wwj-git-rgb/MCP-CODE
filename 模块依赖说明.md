# MCP服务模块依赖说明（优化版）

## 模块依赖图（优化后）

```
                   +----------------+
                   |                |
                   | mcp-web (表现层) |
                   |                |
                   +-------+--------+
                           |
                           | 依赖接口
                           ▼
+----------------+  +------+-------+  +------------------+
|                |  |              |  |                  |
| mcp-api (工具实现) | | mcp-starter | | mcp-application  |
|                |  | (自动配置)    |  | (应用服务)        |
+-------+--------+  +------+-------+  +--------+---------+
        |                  |                   |
        +------------------+-------------------+
                           |
                           | 依赖接口
                           ▼
                  +--------+---------+
                  |                  |
                  | mcp-infrastructure |
                  | (基础设施)         |
                  +--------+---------+
                           |
                           | 依赖接口
                           ▼
                  +--------+---------+
                  |                  |
                  | mcp-domain (领域层) |
                  |                  |
                  +--------+---------+
                           |
                           | 依赖
                           ▼
                  +--------+---------+
                  |                  |
                  | mcp-common (公共层) |
                  |                  |
                  +------------------+
```

## 优化后的模块依赖关系

### 1. mcp-common (公共层)

- **职责**：提供全局通用功能，如异常、常量、结果封装等
- **被依赖**：被所有其他模块依赖
- **依赖**：无依赖其他模块
- **设计优化**：保持轻量化，避免引入与业务相关的代码

### 2. mcp-domain (领域层)

- **职责**：定义领域模型和**领域服务接口**
- **被依赖**：被infrastructure、application、api和starter模块依赖
- **依赖**：仅依赖common模块
- **设计优化**：
  - 所有服务均以接口形式定义
  - 实现DDD的接口与实现分离原则
  - 包含各功能模块的服务接口定义

### 3. mcp-infrastructure (基础设施层)

- **职责**：实现领域服务接口，提供具体技术实现
- **被依赖**：被application、api和starter模块依赖
- **依赖**：依赖domain和common模块
- **设计优化**：
  - 实现领域层定义的接口
  - 使用条件装配支持可插拔特性
  - 避免直接被web层依赖，降低耦合

### 4. mcp-application (应用层)

- **职责**：编排业务流程，实现应用服务
- **被依赖**：被web和starter模块依赖
- **依赖**：依赖infrastructure、domain和common模块
- **设计优化**：
  - 通过接口依赖基础设施层
  - 使用DTO实现防腐层
  - 支持条件装配

### 5. mcp-api (API层)

- **职责**：实现MCP工具接口，提供具体工具实现
- **被依赖**：被starter模块依赖
- **依赖**：依赖infrastructure、domain和common模块
- **设计优化**：
  - 工具实现采用可插拔设计
  - 通过条件装配支持功能开关
  - 每个工具可独立启用/禁用

### 6. mcp-starter (Starter层)

- **职责**：提供自动配置功能，集成所有模块
- **被依赖**：被web模块和主应用依赖
- **依赖**：依赖api、application、infrastructure、domain和common模块
- **设计优化**：
  - 采用条件装配机制
  - 支持按需启用功能模块
  - 实现可插拔架构

### 7. mcp-web (Web层)

- **职责**：提供Web接口和控制器
- **被依赖**：被主应用依赖
- **依赖**：依赖domain（接口）、application和common模块
- **设计优化**：
  - 不直接依赖基础设施实现
  - 通过接口调用功能，降低耦合

### 8. mcp-service (主应用)

- **职责**：提供应用启动入口
- **依赖**：按需引入所需模块
- **设计优化**：
  - 移除业务代码
  - 保持简洁性
  - 支持按需配置

## 优化后的技术架构设计原则

### 1. 接口与实现分离

- 所有业务功能都通过接口定义
- 接口位于domain层，实现位于infrastructure层
- 上层模块只依赖接口，不依赖具体实现

### 2. 条件装配机制

- 使用`@ConditionalOnProperty`实现功能开关
- 支持通过配置属性启用/禁用特定功能
- 实现真正的按需加载

### 3. 可插拔架构

- 每个功能模块可独立开启/关闭
- 支持自定义实现替换默认实现
- 无需修改代码即可调整系统行为

### 4. 接口代理模式

- Web层通过接口调用功能，不直接依赖实现
- 使用依赖注入实现运行时绑定
- 降低模块间耦合度

### 5. 隔离变化

- 将可能变化的部分封装在特定模块中
- 使用适配器模式隔离外部依赖
- 易于扩展和维护

## 使用指南

### 配置功能模块

```yaml
# 启用/禁用整个MCP服务
mcp:
  enabled: true
  
  # 启用/禁用特定功能
  features:
    weather:
      enabled: true
    documentation:
      enabled: false
```

### 替换默认实现

只需提供同名接口的自定义实现并注册为Spring Bean：

```java
@Service
@Primary
public class CustomWeatherDomainService implements WeatherDomainService {
    // 自定义实现
}
```

### 添加新功能模块

1. 在domain层定义接口
2. 在infrastructure层实现接口
3. 在starter中添加条件装配
4. 在配置文件中提供开关